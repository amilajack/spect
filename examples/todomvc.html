<!doctype html>
<html lang="en" data-framework="spect">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Spect â€¢ TodoMVC</title>
  <link rel="stylesheet" href="https://unpkg.com/todomvc-common/base.css">
  <link rel="stylesheet" href="https://unpkg.com/todomvc-app-css/index.css">
</head>

<body>
  <section class="todoapp">
    <header class="header">
      <h1>todos</h1>
      <input class="new-todo" placeholder="What needs to be done?" autofocus>
    </header>
    <!-- This section should be hidden by default and shown when there are todos -->
    <section class="main">
      <input id="toggle-all" class="toggle-all" type="checkbox">
      <label for="toggle-all">Mark all as complete</label>
      <ul class="todo-list"></ul>
    </section>
    <!-- This footer should hidden by default and shown when there are todos -->
    <footer class="footer" hidden>
      <span class="todo-count"><strong>0</strong> item left</span>
      <ul class="filters">
        <li><a class="selected" href="#/">All</a></li>
        <li><a href="#/active">Active</a></li>
        <li><a href="#/completed">Completed</a></li>
      </ul>
      <button class="clear-completed">Clear completed</button>
    </footer>
  </section>
  <footer class="info">
    <p>Double-click to edit a todo</p>
    <p>Created by <a href="https://github.com/dy">dy</a></p>
    <p>Part of <a href="http://todomvc.com">TodoMVC</a></p>
  </footer>
  <script src="https://unpkg.com/todomvc-common/base.js"></script>
  <script type="module">
    import plur from 'https://cdn.pika.dev/plur'
    // import { $, fx, state, store, on } from "https://unpkg.com/spect?module"
    import { $, h, v } from "../index.js"

    let items = v([])
    let [list] = $('.todo-list')

    $('.new-todo', el => {
      el.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
          let item = v({ text: v(e.target.value), done: v(false) })
          items.push(item)
          list.appendChild(h`<li item=${item}/>`)
          e.target.value = ''
        }
      })
    })

    $('.todo-list li', li => {
      const hash = v(window.location.hash)
      window.addEventListener('hashchange', e => hash(window.location.hash))
      const hidden = v(hash, hash => hash === '#/active' ? item.done() : hash === '#/completed' ? !item.done() : false )

      let toggle, edit
      h`<${li} class="${ v(item.done, done => done ? 'completed' : '') }" hidden=${ hidden }>
        <div class="view">
          ${ toggle = h`<input class="toggle" type="checkbox" checked=${ item.done }/>` }
          <label>${ item.text }</label>
          <button class="destroy"></button>
        </div>
        ${ edit = h`<input class=edit value=${ item.text } />` }
      </>`

      v(toggle)(item.done)
      v(edit)(item.text)

      li.addEventListener('dblclick', e => {
        li.classList.add('editing')
        edit.focus()
        edit.onblur = e => li.classList.remove('editing')
        edit.onkeypress = e => e.key === 'Enter' ? e.target.blur() : null
      })
    })

    $('.todo-count', el => {
      h`<${el}>
        <strong>${ v(items, items => items.length) }</strong>
        ${ v(items, items => plur('item', items.length)) }
      </>`
    })

    $('.toggle-all', el => el.addEventListener('click', e => items().map(item => item.done(true))))
    $('.clear-completed', el => el.addEventListener('click', e => items(items().filter(item => !item.done))))

    // if $ is observable that can be done simpler
    $('.main', el => items(items => items.length ? el.setAttribute('hidden', '') : el.removeAttribute('hidden')))
    $('.footer', el => items(items => items.length ? el.setAttribute('hidden', '') : el.removeAttribute('hidden')))
  </script>
</body>
</html>

